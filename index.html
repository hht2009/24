<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24ç‚¹å°æ¸¸æˆâ€”â€”é»„æ˜Šéœ†çš„åšå®¢</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: #fff;
            text-align: center;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .numbers {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .number-card, .operator-button, .bracket-button {
            font-size: 24px;
            padding: 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.9);
            color: #333;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .number-card:hover, .operator-button:hover, .bracket-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
        }
        .input {
            font-size: 18px;
            padding: 10px;
            width: 300px;
            margin-bottom: 20px;
            border: 2px solid #ccc;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            color: #333;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .button {
            font-size: 18px;
            padding: 10px 20px;
            cursor: pointer;
            margin: 10px;
            border: none;
            border-radius: 10px;
            background-color: #ff6f61;
            color: #fff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
        }
        .result {
            font-size: 20px;
            margin-top: 20px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            color: #333;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            width: 80%;
            max-width: 400px;
        }
        .operators, .brackets {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        @media (max-width: 600px) {
            .numbers, .operators, .brackets {
                flex-wrap: wrap;
            }
            .number-card, .operator-button, .bracket-button {
                flex: 1 1 40%;
                font-size: 20px;
                padding: 15px;
            }
            .input {
                width: 90%;
            }
        }
    </style>
</head>
<body>

    <h1>24ç‚¹å°æ¸¸æˆ</h1>
    <div class="numbers">
        <div class="number-card" onclick="addToExpression('num1')" id="num1"></div>
        <div class="number-card" onclick="addToExpression('num2')" id="num2"></div>
        <div class="number-card" onclick="addToExpression('num3')" id="num3"></div>
        <div class="number-card" onclick="addToExpression('num4')" id="num4"></div>
    </div>
    <div class="operators">
        <div class="operator-button" onclick="addToExpression('+')">+</div>
        <div class="operator-button" onclick="addToExpression('-')">-</div>
        <div class="operator-button" onclick="addToExpression('Ã—')">Ã—</div>
        <div class="operator-button" onclick="addToExpression('Ã·')">Ã·</div>
    </div>
    <div class="brackets">
        <div class="bracket-button" onclick="addToExpression('(')">(</div>
        <div class="bracket-button" onclick="addToExpression(')')">)</div>
    </div>
    <input type="text" id="expression" class="input" placeholder="ç‚¹å‡»æ•°å­—ã€è¿ç®—ç¬¦å’Œæ‹¬å·æ„å»ºè¡¨è¾¾å¼" readonly>
    <div>
        <button onclick="checkExpression()" class="button">æäº¤</button>
        <button onclick="clearExpression()" class="button">æ¸…ç©º</button>
        <button onclick="showAnswer()" class="button">æ˜¾ç¤ºç­”æ¡ˆ</button>
        <button onclick="newGame()" class="button">æ¢ä¸€é¢˜</button>
    </div>
    <div id="result" class="result"></div>

    <script>
        // ç”Ÿæˆéšæœºæ•°å­—ï¼ˆç¡®ä¿é¢˜ç›®æœ‰è§£ï¼‰
        function generateValidNumbers() {
            let numbers;
            let count = 0;
            do {
                numbers = [];
                for (let i = 0; i < 4; i++) {
                    numbers.push(Math.floor(Math.random() * 10) + 1);
                }
                count++;
                // é˜²æ­¢æ— é™å¾ªç¯ï¼Œæœ€å¤šå°è¯•100æ¬¡
                if (count > 100) {
                    alert("æ— æ³•ç”Ÿæˆæœ‰æ•ˆé¢˜ç›®ï¼Œè¯·æ‰‹åŠ¨æ¢é¢˜");
                    return numbers;
                }
            } while (!solve24(numbers));
            return numbers;
        }

        // æ˜¾ç¤ºæ•°å­—
        function displayNumbers(numbers) {
            document.getElementById('num1').textContent = numbers[0];
            document.getElementById('num2').textContent = numbers[1];
            document.getElementById('num3').textContent = numbers[2];
            document.getElementById('num4').textContent = numbers[3];
        }

        // æ·»åŠ å†…å®¹åˆ°è¡¨è¾¾å¼è¾“å…¥æ¡†
        function addToExpression(value) {
            const expressionInput = document.getElementById('expression');
            if (value.startsWith('num')) {
                const number = document.getElementById(value).textContent;
                expressionInput.value += number;
            } else {
                expressionInput.value += value;
            }
        }

        // æ¸…ç©ºè¡¨è¾¾å¼è¾“å…¥æ¡†
        function clearExpression() {
            document.getElementById('expression').value = '';
            document.getElementById('result').textContent = '';
        }

        // æ£€æŸ¥è¡¨è¾¾å¼æ˜¯å¦æ­£ç¡®
        function checkExpression() {
            const expression = document.getElementById('expression').value;
            const numbers = [num1, num2, num3, num4];

            try {
                // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ‰€æœ‰æ•°å­—
                const usedAllNumbers = numbers.every(num => 
                    expression.includes(num.toString())
                );
                if (!usedAllNumbers) {
                    document.getElementById('result').textContent = "é”™è¯¯ï¼šæœªä½¿ç”¨æ‰€æœ‰æ•°å­—";
                    return;
                }

                // æ£€æŸ¥æ‹¬å·åŒ¹é…
                if (!isParenthesesBalanced(expression)) {
                    document.getElementById('result').textContent = "é”™è¯¯ï¼šæ‹¬å·ä¸åŒ¹é…";
                    return;
                }

                // è½¬æ¢ç¬¦å·ä¸ºJavaScriptå¯è¯†åˆ«çš„è¿ç®—ç¬¦
                const evalExpression = expression.replace(/Ã—/g, '*').replace(/Ã·/g, '/');

                // è®¡ç®—ç»“æœ
                const result = eval(evalExpression);
                if (Math.abs(result - 24) < 0.0001) {
                    document.getElementById('result').textContent = "ğŸ‰ æ­å–œä½ ï¼Œç­”å¯¹äº†ï¼";
                    setTimeout(newGame, 1500); // 1.5ç§’åè‡ªåŠ¨æ¢é¢˜
                } else {
                    document.getElementById('result').textContent = "âŒ é”™è¯¯ï¼šç»“æœä¸ç­‰äº24";
                }
            } catch (e) {
                document.getElementById('result').textContent = "âŒ é”™è¯¯ï¼šæ— æ•ˆçš„è¡¨è¾¾å¼";
            }
        }

        // æ£€æŸ¥æ‹¬å·åŒ¹é…
        function isParenthesesBalanced(expr) {
            let stack = [];
            for (let char of expr) {
                if (char === '(') stack.push(char);
                if (char === ')') {
                    if (stack.length === 0) return false;
                    stack.pop();
                }
            }
            return stack.length === 0;
        }

        // æ˜¾ç¤ºç­”æ¡ˆ
        function showAnswer() {
            const answer = solve24([num1, num2, num3, num4]);
            document.getElementById('result').textContent = answer ? 
                `ğŸ” ç­”æ¡ˆï¼š${answer}` : "âš ï¸ å½“å‰é¢˜ç›®æ— è§£";
        }

        // ç”Ÿæˆæ–°é¢˜ç›®
        function newGame() {
            const numbers = generateValidNumbers();
            num1 = numbers[0];
            num2 = numbers[1];
            num3 = numbers[2];
            num4 = numbers[3];
            displayNumbers(numbers);
            clearExpression();
        }

        /*------------------ 24ç‚¹è®¡ç®—æ ¸å¿ƒé€»è¾‘ ------------------*/
        // è®¡ç®—24ç‚¹è§£æ³•ï¼ˆå¢å¼ºç‰ˆï¼‰
        function solve24(numbers) {
            const ops = ['+', '-', '*', '/'];
            const solutions = new Set();

            // éå†æ‰€æœ‰æ’åˆ—ç»„åˆ
            for (let permutation of getPermutations(numbers)) {
                for (let op1 of ops) {
                    for (let op2 of ops) {
                        for (let op3 of ops) {
                            // å°è¯•å¤šç§è¿ç®—é¡ºåº
                            const templates = [
                                `(${permutation[0]}${op1}${permutation[1]})${op2}(${permutation[2]}${op3}${permutation[3]})`,
                                `((${permutation[0]}${op1}${permutation[1]})${op2}${permutation[2]})${op3}${permutation[3]}`,
                                `(${permutation[0]}${op1}(${permutation[1]}${op2}${permutation[2]}))${op3}${permutation[3]}`,
                                `${permutation[0]}${op1}((${permutation[1]}${op2}${permutation[2]})${op3}${permutation[3]})`,
                                `${permutation[0]}${op1}(${permutation[1]}${op2}(${permutation[2]}${op3}${permutation[3]}))`
                            ];

                            for (let expr of templates) {
                                try {
                                    if (Math.abs(eval(expr) - 24) < 0.0001) {
                                        return expr.replace(/\*/g, 'Ã—').replace(/\//g, 'Ã·');
                                    }
                                } catch (e) {}
                            }
                        }
                    }
                }
            }
            return null;
        }

        // è·å–å…¨æ’åˆ—ï¼ˆå»é‡ä¼˜åŒ–ï¼‰
        function getPermutations(arr) {
            const result = [];
            const used = new Array(arr.length).fill(false);
            backtrack(arr, [], used, result);
            return result;
        }

        function backtrack(arr, path, used, result) {
            if (path.length === arr.length) {
                result.push([...path]);
                return;
            }
            for (let i = 0; i < arr.length; i++) {
                if (used[i] || (i > 0 && arr[i] === arr[i-1] && !used[i-1])) continue;
                used[i] = true;
                path.push(arr[i]);
                backtrack(arr, path, used, result);
                path.pop();
                used[i] = false;
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        let num1, num2, num3, num4;
        function initGame() {
            newGame();
        }
        window.onload = initGame;
    </script>
</body>
</html>
